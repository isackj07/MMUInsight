{% extends 'base.html' %}

{% block title %}{{ lecturer.email }} - Profile{% endblock %}

{% block content %}
<div class="container">
    <h2>{{ lecturer.email }}</h2>
    <p>Lecturer Profile</p>
    
    {% if averages %}
    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #dee2e6;">
        <h3 style="margin-top: 0;">Average Ratings:</h3>
        <ul style="list-style: none; padding-left: 0;">
            <li><strong>Clarity:</strong> {{ averages.clarity }}/5</li>
            <li><strong>Engagement:</strong> {{ averages.engagement }}/5</li>
            <li><strong>Punctuality:</strong> {{ averages.punctuality }}/5</li>
            <li><strong>Responsiveness:</strong> {{ averages.responsiveness }}/5</li>
            <li><strong>Fairness:</strong> {{ averages.fairness }}/5</li>
        </ul>
    </div>
    {% endif %}
    
    {% if (current_user.id == lecturer.id and current_user.user_type == 'lecturer') or current_user.user_type == 'admin' %}
    <a href="{{ url_for('reviews.analytics', lecturer_id=lecturer.id) }}" style="background-color: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 3px; display: inline-block; margin-bottom: 20px;">ðŸ“Š View Analytics Dashboard</a>
    {% endif %}
    
    {% if current_user.user_type == 'student' %}
    <a href="{{ url_for('reviews.student_analytics', lecturer_id=lecturer.id) }}" style="background-color: #17a2b8; color: white; padding: 10px 20px; text-decoration: none; border-radius: 3px; display: inline-block; margin-bottom: 20px;">ðŸ“ˆ View Student Analytics</a>
    {% endif %}

    <h3>Reviews ({{ reviews|length }})</h3>
    
    {% if reviews %}
        {% for review in reviews %}
        <div style="border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
            <p><strong>By:</strong> {{ review.author.email }}</p>
            <p><strong>Review:</strong> {{ review.review_text }}</p>
            
            <p><strong>Ratings:</strong></p>
            <ul>
                <li>Clarity: {{ review.rating_clarity }}/5</li>
                <li>Engagement: {{ review.rating_engagement }}/5</li>
                <li>Punctuality: {{ review.rating_punctuality }}/5</li>
                <li>Responsiveness: {{ review.rating_responsiveness }}/5</li>
                <li>Fairness: {{ review.rating_fairness }}/5</li>
            </ul>
            
            {% if review.author == current_user %}
            <a href="{{ url_for('reviews.edit_review', review_id=review.id) }}" style="background-color: #ffc107; color: black; padding: 5px 10px; text-decoration: none; border-radius: 3px;">Edit</a>
            <a href="{{ url_for('reviews.delete_review', review_id=review.id) }}" 
               onclick="return confirm('Are you sure you want to delete this review? This cannot be undone.');"
               style="background-color: #dc3545; color: white; padding: 5px 10px; text-decoration: none; border-radius: 3px; margin-left: 5px;">Delete</a>
            {% endif %}
            
            {% if current_user.user_type == 'student' and review.author != current_user %}
            <button onclick="document.getElementById('report-form-{{ review.id }}').style.display='block'" style="background-color: #6c757d; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; margin-left: 5px;">ðŸš© Report</button>
            <div id="report-form-{{ review.id }}" style="display: none; margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 3px;">
                <form method="POST" action="{{ url_for('reviews.report_review', review_id=review.id) }}">
                    <textarea name="reason" rows="2" placeholder="Why are you reporting this review?" style="width: 100%; padding: 8px; margin-bottom: 5px;" required></textarea>
                    <button type="submit" style="background-color: #dc3545; color: white; padding: 5px 15px; border: none; border-radius: 3px; cursor: pointer;">Submit Report</button>
                    <button type="button" onclick="document.getElementById('report-form-{{ review.id }}').style.display='none'" style="background-color: #6c757d; color: white; padding: 5px 15px; border: none; border-radius: 3px; cursor: pointer; margin-left: 5px;">Cancel</button>
                </form>
            </div>
            {% endif %}
            
            {% if review.replies %}
            <div style="margin-top: 20px; padding-left: 20px; border-left: 3px solid #dee2e6;">
                <h4 style="margin-bottom: 10px;">ðŸ’¬ Discussion Thread:</h4>
                {% for reply in review.replies %}
                <div style="margin-bottom: 15px; padding: 10px; background-color: {% if reply.author.user_type == 'lecturer' %}#e7f3ff{% else %}#f8f9fa{% endif %}; border-radius: 3px;">
                    <p style="margin: 0; font-weight: bold; color: {% if reply.author.user_type == 'lecturer' %}#007bff{% else %}#333{% endif %};">
                        {{ reply.author.email }} 
                        {% if reply.author.user_type == 'lecturer' %}(Lecturer){% endif %}
                    </p>
                    <p style="margin: 5px 0;">{{ reply.reply_text }}</p>
                    <p style="font-size: 0.9em; color: #666; margin: 0;">{{ reply.reply_date.strftime('%Y-%m-%d %H:%M') }}</p>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            {% if (current_user.id == lecturer.id and current_user.user_type == 'lecturer') or (current_user.user_type == 'student' and review.author == current_user) %}
            <form method="POST" action="{{ url_for('reviews.add_reply', review_id=review.id) }}" style="margin-top: 15px;">
                <textarea name="reply_text" rows="2" placeholder="Write a reply..." style="width: 100%; padding: 8px;" required></textarea>
                <button type="submit" style="background-color: #007bff; color: white; padding: 8px 15px; border: none; border-radius: 3px; margin-top: 5px; cursor: pointer;">Post Reply</button>
            </form>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <p>No reviews yet.</p>
    {% endif %}
    
    {% if current_user.user_type == 'student' %}
    <a href="{{ url_for('reviews.create_review', lecturer_id=lecturer.id) }}" style="background-color: #007bff; color: white; padding: 8px 15px; text-decoration: none; border-radius: 3px;">Write a Review</a>
    {% endif %}
    
    <br><br>
    <a href="{{ url_for('index') }}">Back to Home</a>
</div>
{% endblock %}