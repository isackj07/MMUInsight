{% extends 'base.html' %}

{% block title %}Analytics - {{ lecturer.email }}{% endblock %}

{% block content %}
<div class="container">
    <h2>Analytics Dashboard</h2>
    <h3>{{ lecturer.email }}</h3>
    
    <div style="background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 20px;">
        <h3>Overview</h3>
        {% if averages %}
        <p style="font-size: 2.5em; margin: 10px 0; color: #007bff;"><strong>{{ overall_rating }}/5</strong></p>
        <p style="color: #666;">Overall Rating</p>
        {% endif %}
        <p><strong>Total Reviews:</strong> {{ total_reviews }}</p>
    </div>
    
    {% if averages %}
    
    {% if strongest and weakest %}
    <div style="background-color: #fff; padding: 20px; border: 1px solid #dee2e6; border-radius: 5px; margin-bottom: 20px;">
        <h3>Performance Insights</h3>
        <p style="color: #28a745;"><strong>Strongest Category:</strong> {{ strongest.title() }} ({{ averages[strongest] }}/5)</p>
        <p style="color: #dc3545;"><strong>Needs Improvement:</strong> {{ weakest.title() }} ({{ averages[weakest] }}/5)</p>
    </div>
    {% endif %}
    
    <div style="background-color: #fff; padding: 20px; border: 1px solid #dee2e6; border-radius: 5px; margin-bottom: 30px;">
        <h3>Category Averages</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 2px solid #dee2e6;">
                <th style="text-align: left; padding: 10px;">Category</th>
                <th style="text-align: center; padding: 10px;">Average Rating</th>
            </tr>
            <tr style="border-bottom: 1px solid #dee2e6;">
                <td style="padding: 10px;">Clarity</td>
                <td style="text-align: center; padding: 10px;">{{ averages.clarity }}/5</td>
            </tr>
            <tr style="border-bottom: 1px solid #dee2e6;">
                <td style="padding: 10px;">Engagement</td>
                <td style="text-align: center; padding: 10px;">{{ averages.engagement }}/5</td>
            </tr>
            <tr style="border-bottom: 1px solid #dee2e6;">
                <td style="padding: 10px;">Punctuality</td>
                <td style="text-align: center; padding: 10px;">{{ averages.punctuality }}/5</td>
            </tr>
            <tr style="border-bottom: 1px solid #dee2e6;">
                <td style="padding: 10px;">Responsiveness</td>
                <td style="text-align: center; padding: 10px;">{{ averages.responsiveness }}/5</td>
            </tr>
            <tr>
                <td style="padding: 10px;">Fairness</td>
                <td style="text-align: center; padding: 10px;">{{ averages.fairness }}/5</td>
            </tr>
        </table>
    </div>
    
    <div style="background-color: #fff; padding: 20px; border: 1px solid #dee2e6; border-radius: 5px; margin-bottom: 30px;">
        <h3>Performance Visual</h3>
        
        <div style="margin-bottom: 15px;">
            <p style="margin: 5px 0;"><strong>Clarity:</strong> {{ averages.clarity }}/5</p>
            <div style="width: 100%; background-color: #e9ecef; border-radius: 3px; height: 25px;">
                <div style="width: {{ (averages.clarity / 5) * 100 }}%; background-color: #36a2eb; height: 25px; border-radius: 3px; text-align: center; line-height: 25px; color: white; font-weight: bold;">{{ averages.clarity }}</div>
            </div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <p style="margin: 5px 0;"><strong>Engagement:</strong> {{ averages.engagement }}/5</p>
            <div style="width: 100%; background-color: #e9ecef; border-radius: 3px; height: 25px;">
                <div style="width: {{ (averages.engagement / 5) * 100 }}%; background-color: #4bc0c0; height: 25px; border-radius: 3px; text-align: center; line-height: 25px; color: white; font-weight: bold;">{{ averages.engagement }}</div>
            </div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <p style="margin: 5px 0;"><strong>Punctuality:</strong> {{ averages.punctuality }}/5</p>
            <div style="width: 100%; background-color: #e9ecef; border-radius: 3px; height: 25px;">
                <div style="width: {{ (averages.punctuality / 5) * 100 }}%; background-color: #ffce56; height: 25px; border-radius: 3px; text-align: center; line-height: 25px; color: white; font-weight: bold;">{{ averages.punctuality }}</div>
            </div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <p style="margin: 5px 0;"><strong>Responsiveness:</strong> {{ averages.responsiveness }}/5</p>
            <div style="width: 100%; background-color: #e9ecef; border-radius: 3px; height: 25px;">
                <div style="width: {{ (averages.responsiveness / 5) * 100 }}%; background-color: #9966ff; height: 25px; border-radius: 3px; text-align: center; line-height: 25px; color: white; font-weight: bold;">{{ averages.responsiveness }}</div>
            </div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <p style="margin: 5px 0;"><strong>Fairness:</strong> {{ averages.fairness }}/5</p>
            <div style="width: 100%; background-color: #e9ecef; border-radius: 3px; height: 25px;">
                <div style="width: {{ (averages.fairness / 5) * 100 }}%; background-color: #ff6384; height: 25px; border-radius: 3px; text-align: center; line-height: 25px; color: white; font-weight: bold;">{{ averages.fairness }}</div>
            </div>
        </div>
    </div>
    
    {% if lecturer_stats %}
    <div style="background-color: #fff; padding: 20px; border: 1px solid #dee2e6; border-radius: 5px; margin-bottom: 20px;">
        <h3>Admin View: All Lecturers Comparison</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 2px solid #dee2e6;">
                <th style="text-align: left; padding: 10px;">Rank</th>
                <th style="text-align: left; padding: 10px;">Lecturer</th>
                <th style="text-align: center; padding: 10px;">Overall Rating</th>
                <th style="text-align: center; padding: 10px;">Total Reviews</th>
            </tr>
            {% for stat in lecturer_stats %}
            <tr style="border-bottom: 1px solid #dee2e6; {% if stat.id == lecturer.id %}background-color: #fff3cd;{% endif %}">
                <td style="padding: 10px;">{{ loop.index }}</td>
                <td style="padding: 10px;">
                    <a href="{{ url_for('reviews.analytics', lecturer_id=stat.id) }}">{{ stat.email }}</a>
                </td>
                <td style="text-align: center; padding: 10px;">{{ stat.overall }}/5</td>
                <td style="text-align: center; padding: 10px;">{{ stat.total_reviews }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}
    
    {% else %}
    <p>No reviews yet. Analytics will appear once students submit reviews.</p>
    {% endif %}
    
    <br>
    <a href="{{ url_for('reviews.lecturer_profile', lecturer_id=lecturer.id) }}">Back to Profile</a>
</div>
{% endblock %}